<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Financial Health Report</title>
    <link rel="stylesheet" href="assets/css/style.css" />
    <link
      href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;500;600;700&family=Overpass:wght@600;700&display=swap"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
      body {
        background: white;
        margin: 0;
        padding: 10px;
        font-family: "Nunito", sans-serif;
        width: 800px;
        min-height: auto;
        max-width: none;
        overflow: hidden;
      }

      /* Header with both logos */
      .report-header-logos {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
        padding-bottom: 10px;
        border-bottom: 1px solid #e5e5e5;
      }

      .report-logo img {
        height: 40px;
      }

      .report-logo-right img {
        height: 40px;
      }

      /* Compact spacing for single page fit */
      .report-header {
        margin-bottom: 15px;
        padding-bottom: 10px;
      }

      .report-title {
        font-size: 22px;
        margin: 0;
      }

      .report-card-note {
        margin-bottom: 15px;
        font-size: 12px;
        line-height: 1.4;
      }

      .report-cards-container {
        display: grid;
        grid-template-columns: 1fr;
        gap: 15px;
        margin-bottom: 15px;
      }

      .report-card {
        padding: 15px;
        margin-bottom: 0;
      }

      .card-header {
        margin-bottom: 10px;
      }

      .card-header h3 {
        font-size: 16px;
        margin: 0;
      }

      .gauge-section {
        margin-bottom: 10px;
      }

      .gauge-wrapper {
        height: 80px;
        margin-bottom: 8px;
      }

      .chart-img {
        width: 4rem;
        margin: 0 auto 8px;
      }

      .risk-badge,
      .health-badge {
        padding: 6px 12px;
        font-size: 11px;
        margin-bottom: 8px;
        border-radius: 20px;
        color: #fff !important;
        font-weight: 600;
        position: relative;
        display: inline-block;
        text-align: center;
        min-width: 80px;
        line-height: 1.2;
      }

      .risk-description,
      .health-description {
        font-size: 12px;
        margin-bottom: 10px;
        line-height: 1.3;
      }

      .recommendations-section {
        padding: 10px;
        margin-bottom: 0;
      }

      .recommendations-header {
        margin-bottom: 8px;
        font-size: 12px;
      }

      .recommendations-list {
        margin: 0;
      }

      .recommendations-list li {
        font-size: 11px;
        margin-bottom: 4px;
        line-height: 1.3;
      }

      .snapshot-section {
        margin-bottom: 15px;
      }

      .snapshot-section h3 {
        font-size: 16px;
        margin-bottom: 10px;
      }

      .snapshot-cards {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 8px;
        margin-bottom: 15px;
      }

      .snapshot-card {
        padding: 12px;
        background: white;
        border: 1px solid #e5e5e5;
        border-radius: 8px;
      }

      .snapshot-label {
        font-size: 10px;
        margin-bottom: 2px;
      }

      .snapshot-value {
        font-size: 11px;
        line-height: 1.2;
      }

      /* Footer styles */
      .report-footer {
        margin-top: 20px;
        padding: 15px;
        background-color: #e1f6f5;
        font-size: 10px;
        color: #666;
        line-height: 1.4;
        text-align: center;
        border-radius: 8px;
      }

      .report-footer p {
        margin: 0;
        padding: 2px 0;
      }

      /* Hide elements not needed in PDF */
      .timer-display,
      .report-actions,
      .feedback-back,
      .rating-section,
      .next-steps,
      .take-assessment-btn {
        display: none !important;
      }

      /* Force desktop layout regardless of device */
      @media screen and (max-width: 768px) {
        body {
          width: 800px !important;
          padding: 10px !important;
        }

        .report-cards-container {
          grid-template-columns: 1fr !important;
        }

        .snapshot-cards {
          grid-template-columns: repeat(3, 1fr) !important;
        }
      }

      /* Print styles for single page layout */
      @media print {
        @page {
          size: A4;
          margin: 12mm 10mm;
        }

        body {
          font-size: 12px !important;
          line-height: 1.4 !important;
          color: #000 !important;
          background: white !important;
          transform: none !important;
          zoom: 1 !important;
          width: auto !important;
          height: auto !important;
        }

        /* Hide unnecessary elements */
        .report-actions,
        .rating-section,
        .next-steps,
        .take-assessment-btn,
        .timer-display,
        .feedback-back,
        .expert-session-btn {
          display: none !important;
        }

        /* Proper spacing for print */
        .report-header {
          margin-bottom: 12px !important;
          padding-bottom: 8px !important;
        }

        .report-title {
          font-size: 20px !important;
          margin: 0 !important;
          line-height: 1.3 !important;
        }

        .report-card-note {
          font-size: 11px !important;
          margin-bottom: 12px !important;
          line-height: 1.4 !important;
        }

        .report-cards-container {
          gap: 12px !important;
          margin-bottom: 12px !important;
        }

        .report-card {
          padding: 12px !important;
          margin-bottom: 0 !important;
          page-break-inside: avoid;
          break-inside: avoid;
        }

        .card-header {
          margin-bottom: 8px !important;
        }

        .card-header h3 {
          font-size: 16px !important;
          margin: 0 0 6px 0 !important;
        }

        .gauge-wrapper {
          height: 100px !important;
          margin-bottom: 8px !important;
        }

        .chart-img {
          width: 4rem !important;
          margin: 8px auto !important;
        }

        .risk-badge,
        .health-badge {
          font-size: 11px !important;
          padding: 6px 10px !important;
          margin-bottom: 8px !important;
        }

        .risk-description,
        .health-description {
          font-size: 12px !important;
          margin-bottom: 8px !important;
          line-height: 1.4 !important;
        }

        .recommendations-section {
          padding: 10px !important;
          margin-bottom: 0 !important;
        }

        .recommendations-header {
          font-size: 11px !important;
          margin-bottom: 6px !important;
        }

        .recommendations-list {
          margin: 0 !important;
        }

        .recommendations-list li {
          font-size: 11px !important;
          margin-bottom: 3px !important;
          line-height: 1.3 !important;
        }

        .snapshot-section {
          margin-bottom: 12px !important;
        }

        .snapshot-section h3 {
          font-size: 16px !important;
          margin-bottom: 8px !important;
        }

        .snapshot-cards {
          gap: 8px !important;
          margin-bottom: 10px !important;
        }

        .snapshot-card {
          padding: 10px !important;
        }

        .snapshot-label {
          font-size: 11px !important;
          margin-bottom: 3px !important;
        }

        .snapshot-value {
          font-size: 12px !important;
          line-height: 1.3 !important;
        }

        /* Disclaimer */
        div[style*="margin-top: 15px"] {
          margin-top: 8px !important;
          margin-bottom: 8px !important;
        }

        div[style*="margin-top: 15px"] p {
          font-size: 10px !important;
          line-height: 1.3 !important;
        }

        /* Report footer */
        .report-footer {
          margin-top: 12px !important;
          font-size: 10px !important;
          line-height: 1.3 !important;
        }

        /* Color preservation */
        * {
          -webkit-print-color-adjust: exact !important;
          color-adjust: exact !important;
          print-color-adjust: exact !important;
        }

        /* Canvas/Charts */
        canvas {
          max-width: 100% !important;
          height: auto !important;
        }
      }
    </style>
  </head>
  <body>
    <!-- Header with both logos -->
    <div class="report-header-logos">
      <div class="report-logo">
        <img src="./assets/images/logo.svg" alt="Geojit Logo" />
      </div>
      <div class="report-logo-right">
        <img src="./assets/images/FFT-1.svg" alt="Geojit Financial Fitness Test" />
      </div>
    </div>

    <!-- Copy exact structure from your feedback card -->
    <div class="feedback-container">
      <div class="feedback-content-wrapper">
        <div class="feedback-content">
          <div id="report-to-download" class="report-download-wrapper">
            <!-- Report Header -->
            <div class="report-header">
              <div class="report-title-section">
                <h2 class="report-title">
                  <span class="user-name" id="report-user-name">Your</span>
                  <span data-key="feedbackReportTitle">Financial Health Report</span>
                </h2>
              </div>
            </div>

            <p class="report-card-note" data-key="reportCardNote">
              This report provides an indication of your financial health. Please speak to our expert to understand the
              details and to create a suitable financial road map.
            </p>

            <!-- Report Cards Layout -->
            <div class="report-cards-container">
              <!-- Risk Profile Card -->
              <div class="report-card risk-card">
                <div class="report-card-left">
                  <div class="card-header">
                    <img src="./assets/images/risk-profile.svg" alt="risk profile" class="card-icon" />
                    <h3 data-key="riskProfileLabel">Risk Profile</h3>
                  </div>

                  <div class="gauge-section">
                    <div class="gauge-wrapper">
                      <canvas id="riskGaugeChart" width="200" height="80"></canvas>
                    </div>
                  </div>
                </div>
                <div class="report-card-right">
                  <div class="gauge-info">
                    <div class="risk-badge" id="risk-badge">Moderate Risk</div>
                  </div>
                  <p class="risk-description" id="risk-description">
                    You're open to some risk in exchange for better returns. A balanced investment approach can work
                    well for you.
                  </p>
                  <div class="recommendations-section">
                    <div class="recommendations-header">
                      <img src="./assets/images/expert-icon.svg" alt="Expert" class="expert-icon" />
                      <span data-key="recommendationsByGeojit">Recommendations by Geojit</span>
                    </div>
                    <ul class="recommendations-list" id="risk-recommendations">
                      <li>Balanced Advantage Funds or Hybrid Equity Funds</li>
                      <li>Mixing equity with safer investments for stability</li>
                    </ul>
                  </div>
                </div>
              </div>

              <!-- Financial Health Card -->
              <div class="report-card health-card">
                <div class="report-card-left">
                  <div class="card-header">
                    <img src="./assets/images/financial-health.svg" alt="financial health" class="card-icon" />
                    <h3 data-key="financialHealthLabel">Financial Health</h3>
                  </div>

                  <img src="./assets/images/needs-improvement.svg" alt="health" class="chart-img" id="chart-img" />

                  <div class="gauge-section">
                    <div class="gauge-wrapper">
                      <canvas id="healthGaugeChart" width="200" height="80"></canvas>
                    </div>
                  </div>
                </div>
                <div class="report-card-right">
                  <div class="gauge-info">
                    <div class="health-badge" id="health-badge">Needs Improvement</div>
                  </div>
                  <p class="health-description" id="health-description">
                    Your financial health needs attention. It looks like you're either not saving regularly, lack a
                    safety net or are under insured.
                  </p>
                  <div class="recommendations-section">
                    <div class="recommendations-header">
                      <img src="./assets/images/expert-icon.svg" alt="Expert" class="expert-icon" />
                      <span data-key="recommendationsByGeojit">Recommendations by Geojit</span>
                    </div>
                    <ul class="recommendations-list" id="health-recommendations">
                      <li>Building an emergency fund</li>
                      <li>Creating a habit of tracking income and expenses</li>
                      <li>Setting basic life and health insurance in place</li>
                    </ul>
                  </div>
                </div>
              </div>
            </div>

            <!-- Financial Health Snapshot -->
            <div class="snapshot-section">
              <h3 data-key="yourFinancialHealthSnapshot">Your Financial Health Snapshot</h3>
              <div class="snapshot-cards">
                <div class="snapshot-card">
                  <div class="snapshot-label" data-key="riskPreference">Risk Preference</div>
                  <div class="snapshot-value" id="snapshot-risk">Open to some risk</div>
                </div>
                <div class="snapshot-card">
                  <div class="snapshot-label" data-key="weakArea">Improvement Zone</div>
                  <div class="snapshot-value" id="snapshot-weak">Not saving regularly / Lack of safety net</div>
                </div>
                <div class="snapshot-card">
                  <div class="snapshot-label" data-key="actionNeeded">Action Needed</div>
                  <div class="snapshot-value" id="snapshot-action">Improve insurance coverage</div>
                </div>
              </div>
            </div>

            <!-- Disclaimer -->
            <div style="margin-top: 15px; margin-bottom: 15px">
              <p style="font-weight: bold; font-size: 12px" data-key="reportDisclaimer">
                Disclaimer: This report provides only an indicative assessment of your financial health and risk
                profile. It should not be considered as financial advice or a comprehensive evaluation.
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Footer -->
    <div class="report-footer">
      <p>
        Geojit Financial Services Ltd., Registered Office: 34/659-P, Civil Line Road, Padivattom, Kochi-682024, Kerala,
        India.
      </p>
      <p>Phone: +91 484-2901000. Website: www.geojit.com</p>
    </div>

    <script>
      // Copy your chart functions here
      let riskChart = null;
      let healthChart = null;

      function updateRiskGauge(riskProfileScore, translations, currentLanguage) {
        const ctx = document.getElementById("riskGaugeChart");
        if (!ctx) return;

        if (riskChart) {
          riskChart.destroy();
        }

        // Calculate needle position based on risk score (0-12 scale)
        let targetAngle;

        if (riskProfileScore <= 4) {
          // Low Risk: 0-4 points (first segment - GREEN)
          targetAngle = -90 + (riskProfileScore / 4) * 60;
        } else if (riskProfileScore <= 8) {
          // Moderate Risk: 5-8 points (middle segment - ORANGE)
          targetAngle = -30 + ((riskProfileScore - 4) / 4) * 60;
        } else {
          // High Risk: 9-12 points (last segment - RED)
          targetAngle = 30 + ((riskProfileScore - 8) / 4) * 60;
        }

        const data = {
          labels: [
            translations[currentLanguage].riskLow,
            translations[currentLanguage].riskBadgeModerate,
            translations[currentLanguage].riskHigh,
          ],
          datasets: [
            {
              data: [33.33, 33.33, 33.33], // Equal segments
              backgroundColor: ["#57B272", "#F7A219", "#EB3333"], // Green, Orange, Red
              borderWidth: 4,
              borderColor: "#fff",
              cutout: "70%",
              circumference: 180,
              rotation: 270,
            },
          ],
        };

        riskChart = new Chart(ctx, {
          type: "doughnut",
          data: data,
          options: {
            responsive: true,
            maintainAspectRatio: false,
            animation: { duration: 0 },
            plugins: {
              legend: {
                display: true,
                position: "bottom",
                labels: {
                  usePointStyle: true,
                  pointStyle: "circle",
                  font: { size: 9 },
                  color: "#666",
                  padding: 8,
                },
              },
              tooltip: { enabled: false },
            },
          },
          plugins: [
            {
              id: "needle",
              afterDatasetDraw(chart, args, options) {
                const {
                  ctx,
                  chartArea: { width, height },
                } = chart;
                ctx.save();

                // Convert target angle to radians and adjust for chart rotation
                const angle = (270 + targetAngle) * (Math.PI / 180);
                const cx = width / 2;
                const cy = height * 0.78;
                const needleLength = height * 0.45;

                const needleX = cx + Math.cos(angle) * needleLength;
                const needleY = cy + Math.sin(angle) * needleLength;

                // Draw needle line
                ctx.beginPath();
                ctx.moveTo(cx, cy);
                ctx.lineTo(needleX, needleY);
                ctx.lineWidth = 3;
                ctx.strokeStyle = "#000";
                ctx.lineCap = "round";
                ctx.stroke();

                // Draw needle center circle
                ctx.beginPath();
                ctx.arc(cx, cy, 6, 0, 2 * Math.PI);
                ctx.fillStyle = "#000";
                ctx.fill();

                ctx.restore();
              },
            },
          ],
        });
      }
      function updateHealthGauge(financialHealthScore, translations, currentLanguage) {
        const ctx = document.getElementById("healthGaugeChart");
        if (!ctx) return;

        if (healthChart) {
          healthChart.destroy();
        }

        const healthPercentage = (financialHealthScore / 18) * 100;

        const data = {
          labels: ["Financial Health"],
          datasets: [
            {
              label: translations[currentLanguage].healthBadgeNeedsImprovement,
              data: [38.89],
              backgroundColor: "#F7A219",
              borderWidth: 0,
              barPercentage: 0.25,
              categoryPercentage: 0.8,
            },
            {
              label: translations[currentLanguage].healthBadgeModerate,
              data: [27.78],
              backgroundColor: "#FECC09",
              borderWidth: 0,
              barPercentage: 0.25,
              categoryPercentage: 0.8,
            },
            {
              label: translations[currentLanguage].healthBadgeOnTrack,
              data: [33.33],
              backgroundColor: "#7DBB42",
              borderWidth: 0,
              barPercentage: 0.25,
              categoryPercentage: 0.8,
            },
          ],
        };

        healthChart = new Chart(ctx, {
          type: "bar",
          data: data,
          options: {
            indexAxis: "y",
            responsive: true,
            maintainAspectRatio: false,
            animation: { duration: 0 },
            scales: {
              x: {
                stacked: true,
                display: false,
                max: 100,
                beginAtZero: true,
              },
              y: {
                stacked: true,
                display: false,
              },
            },
            plugins: {
              legend: {
                display: true,
                position: "bottom",
                labels: {
                  usePointStyle: true,
                  pointStyle: "circle",
                  font: { size: 9 },
                  boxWidth: 8,
                  boxHeight: 8,
                  color: "#666",
                  padding: 8,
                },
              },
              tooltip: { enabled: false },
            },
            layout: {
              padding: {
                left: 3,
                right: 3,
                bottom: 3,
                top: 3,
              },
            },
          },
          plugins: [
            {
              id: "needle",
              afterDatasetsDraw(chart) {
                const {
                  ctx,
                  chartArea: { left, right, top, bottom },
                } = chart;

                const needleX = left + (healthPercentage / 100) * (right - left);
                const barCenter = (top + bottom) / 2;

                ctx.save();
                ctx.fillStyle = "#000";
                ctx.beginPath();
                ctx.moveTo(needleX, barCenter - 6);
                ctx.lineTo(needleX - 4, barCenter - 12);
                ctx.lineTo(needleX + 4, barCenter - 12);
                ctx.closePath();
                ctx.fill();
                ctx.restore();
              },
            },
          ],
        });
      }
    </script>
  </body>
</html>
